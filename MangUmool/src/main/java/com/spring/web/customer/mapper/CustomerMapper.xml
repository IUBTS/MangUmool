<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.web.customer.mapper.CustomerMapper">
<!-- 
	<insert id='join'
			parameterType='com.spring.web.customer.vo.Customer'>
			
		INSERT INTO TRADI_CUSTOMER(CNUM,CID,PWD,CNAME,NICKNAME,ADDRESS,PHONE,EMAIL,BIRTH)
		VALUES(CUSTOMER_SEQ.NEXTVAL,#{cid},#{pwd},#{cname},#{nickname},#{address},#{phone},#{email},#{birth})			
	</insert>
	
	<select id='idDupliCheck'
			parameterType="String"
			resultType="String">
			
			SELECT CID FROM TRADI_CUSTOMER WHERE CID=#{cid}
			
	</select>
	
	
	
	<select id="login"
			parameterType="com.spring.web.customer.vo.Customer"
			resultType='com.spring.web.customer.vo.Customer'>
					SELECT CNUM,CID,PWD,NICKNAME FROM TRADI_CUSTOMER WHERE CID=#{cid}	AND PWD=#{pwd}	
	</select>		

	
	<select id='getmyinfo'
			parameterType="Integer"
			resultType="com.spring.web.customer.vo.Customer">
	
		SELECT * FROM TRADI_CUSTOMER WHERE CNUM=#{cnum}
	
	</select>

	<select id="checkPwd"
			parameterType="com.spring.web.customer.vo.Customer"
			resultType="Integer">
	
		SELECT cnum FROM TRADI_CUSTOMER 
		WHERE CNUM=#{cnum} AND PWD=#{pwd}
		
	</select>
	
	
	<update id="updatePwd"
			parameterType="com.spring.web.customer.vo.Customer">
	
		UPDATE TRADI_CUSTOMER
		SET PWD = #{pwd}
		WHERE CNUM = #{cnum}		
			
	</update>		
	
	<update id='editEmail'
			parameterType='com.spring.web.customer.vo.Customer'>
						
		UPDATE TRADI_CUSTOMER SET email=#{email}
		WHERE CNUM = #{cnum}
			
	</update>
	
-->

	<select id='getmyorder'
			parameterType="Integer"
			resultType="map">
	
		SELECT a.onum,a.orderdate,b.oinum,b.name,b.itemcode,b.amount,b.confirm,b.price,c.fname,r.rnum
		FROM TRADI_ORDER a
		LEFT OUTER JOIN TRADI_ORDERITEM b
		ON a.onum = b.onum
		INNER JOIN TRADI_I_ATTACH c
		ON b.itemcode = c.itemcode
		LEFT OUTER JOIN TRADI_REVIEW r
		ON b.oinum = r.oinum
		WHERE a.CNUM=#{cnum} AND c.fname LIKE 'thumnail%'  
		ORDER BY a.orderdate DESC , b.confirm
	
	</select>
	
	<insert id="regCancle"
			parameterType="com.spring.web.customer.vo.Cancle">
	
		INSERT INTO TRADI_CANCLE_ORDER(CANNUM,ONUM,OINUM,REASON,CNUM,ITEMCODE)
		VALUES (TRADI_CANCLE_SEQ.NEXTVAL,#{onum},#{oinum},#{reason},#{cnum},#{itemcode})
	
	</insert>
	
	<update id="setConfirmByCancle"
			parameterType="Integer">
			
		UPDATE TRADI_ORDERITEM 
		SET CONFIRM = 3
		WHERE OINUM = #{oinum}		
			
	</update>
	
	<insert id="addReview"
			parameterType="com.spring.web.customer.vo.Review">
		
		INSERT INTO TRADI_REVIEW (RNUM,CNUM,ITEMCODE,OINUM,CONTENT,SCORE)
		VALUES(TRADI_REVIEW_SEQ.NEXTVAL,#{cnum},#{itemcode},#{oinum},#{content},#{score})	
			
	</insert>
	
	<select id='detailorder'
			parameterType="Integer"
			resultType="map">
			
		SELECT a.*,b.*,c.fname
		FROM TRADI_ORDER a
		LEFT OUTER JOIN TRADI_ORDERITEM b
		ON a.onum = b.onum
		INNER JOIN TRADI_I_ATTACH c
		ON b.itemcode = c.itemcode
		WHERE b.oinum=#{oinum} AND c.fname LIKE 'thumnail%'   

	
	</select>
<!-- 
	<update id="updateAddress"
			parameterType="com.spring.web.customer.vo.Customer">
			
		UPDATE TRADI_CUSTOMER
		SET ADDRESS=#{address} 
		WHERE CNUM = #{cnum}	
			
	</update>
	<update id="updatePhone"
			parameterType="com.spring.web.customer.vo.Customer">
			
		UPDATE TRADI_CUSTOMER
		SET PHONE = #{phone}
		WHERE CNUM = #{cnum}	
			
	</update>
-->


</mapper>   

